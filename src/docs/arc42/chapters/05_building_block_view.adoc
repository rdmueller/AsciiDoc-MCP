:jbake-title: Building Block View
:jbake-type: page_toc
:jbake-status: published
:jbake-menu: arc42
:jbake-order: 5
:filename: /chapters/05_building_block_view.adoc
ifndef::imagesdir[:imagesdir: ../../images]

:toc:

[[section-building-block-view]]
== Building Block View

This chapter describes the static decomposition of the system into its key building blocks. We use the C4 model to illustrate the structure at different levels of detail.

=== Level 2: System Containers

The dacli system provides two interfaces: a CLI tool for direct command-line usage and an MCP server for LLM integration. The file system acts as the system's database.

[plantuml, container-overview, svg]
----
@startuml
!include <C4/C4_Container>
LAYOUT_TOP_DOWN()
SHOW_LEGEND()

title Container diagram for dacli

Person(user, "Developer / Architect", "Uses the system via CLI or MCP client.")

System_Boundary(mcp_system, "dacli") {
    Container(cli, "CLI Tool", "Python, Click", "Provides command-line access to all documentation tools (dacli).")
    Container(mcp, "MCP Server", "Python, FastMCP", "Provides MCP-compliant tools for LLM integration (dacli-mcp).")
}

System_Ext(file_system, "File System", "Stores the AsciiDoc and Markdown files.")

Rel(user, cli, "Executes commands", "Shell")
Rel(user, mcp, "Sends tool calls via MCP Client", "stdio")
Rel(cli, file_system, "Reads/Writes", "File System API")
Rel(mcp, file_system, "Reads/Writes", "File System API")
@enduml
----

=== Level 3: Components of the MCP Server

We now zoom into the `MCP Server` container. It is composed of several components, each with a distinct responsibility.

[plantuml, component-detail-api, svg]
----
@startuml
!include <C4/C4_Component>
LAYOUT_WITH_LEGEND()

title Component diagram for MCP Server

Container_Boundary(api, "MCP Server") {
    Component(mcp_tools, "MCP Tools", "FastMCP", "Exposes tools for navigation, search, manipulation via MCP protocol.")
    Component(parser, "Document Parsers", "Python", "Parses AsciiDoc/Markdown files, resolves includes, builds AST with line numbers.")
    Component(index, "Structure Index", "Python (In-Memory)", "Stores hierarchical structure for fast lookups.")
    Component(fs_handler, "File System Handler", "Python", "Performs atomic read/write operations on the file system.")
}

System_Ext(file_system, "File System")

Rel(mcp_tools, index, "Queries", "Structure & Search")
Rel(mcp_tools, fs_handler, "Uses", "Read/Write content")
Rel(parser, fs_handler, "Reads files via")
Rel(index, parser, "Is built by")
Rel(fs_handler, file_system, "Interacts with")
@enduml
----

NOTE: The CLI tool (`dacli`) shares the same core components (parsers, index, file handler) but operates synchronously via the command line.

=== Component Responsibilities

The following table maps components to the MCP tools:

.Component to MCP Tool Mapping
[cols="2,3,2"]
|===
| Component | Responsibility | MCP Tools

| **MCP Tools**
| Exposes all functionality via MCP protocol
| get_structure, get_section, get_sections_at_level, search, get_elements, get_metadata, validate_structure, update_section, insert_content

| **Document Parsers**
| Parse AsciiDoc/Markdown, resolve includes, track line numbers
| (Internal - used during initialization)

| **Structure Index**
| In-memory index for fast lookups of sections and elements
| (Internal - supports all read operations)

| **File System Handler**
| Atomic file read/write operations with backup strategy
| (Internal - supports write operations, ADR-004)
|===

=== Data Models

The following core data models are used across components (see API Specification for details):

* **SectionLocation** - File path and line range for a section
* **Section** - Hierarchical document section with metadata
* **Element** - Typed content element (table, code, diagram)
* **SearchResult** - Search hit with context and relevance score
* **Metadata** - Document or section metadata
* **ValidationResult** - Structure validation outcome
