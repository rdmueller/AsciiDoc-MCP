:jbake-title: Use Cases
:jbake-type: page_toc
:jbake-status: published
:jbake-order: 1
ifndef::imagesdir[:imagesdir: ../../images]

:toc:

= MCP Documentation Server - Use Case Specification
:sectnums:
:icons: font

== Introduction

This document describes the use cases of the MCP Documentation Server based on the PRD.
Each use case contains a description, preconditions, flow, and an activity diagram.

== Actors

[cols="1,3"]
|===
| Actor | Description

| **LLM Client**
| An MCP-compatible client (e.g., Claude, GPT) that communicates with the server via the MCP protocol.

| **Software Developer**
| Developer who analyzes and maintains code documentation with LLM assistance.

| **Software Architect**
| Architect who manages technical documentation (e.g., arc42) with LLM assistance.

| **Documentation Engineer**
| Documentation specialist who manages large documentation projects.

| **System Administrator**
| Operates and configures the MCP Documentation Server.
|===

== System Boundaries

[plantuml, system-boundary, svg]
----
@startuml
left to right direction
skinparam packageStyle rectangle

actor "LLM Client" as llm
actor "Developer" as dev
actor "Architect" as arch
actor "Doc Engineer" as doc

rectangle "MCP Documentation Server" {
  usecase "UC-01: Get document structure" as UC01
  usecase "UC-02: Read section" as UC02
  usecase "UC-03: Update section" as UC03
  usecase "UC-04: Search content" as UC04
  usecase "UC-05: Filter elements" as UC05
  usecase "UC-06: Get metadata" as UC06
  usecase "UC-07: Validate structure" as UC07
  usecase "UC-08: Initialize server" as UC08
}

llm --> UC01
llm --> UC02
llm --> UC03
llm --> UC04
llm --> UC05
llm --> UC06
llm --> UC07

dev --> llm
arch --> llm
doc --> llm

UC08 <-- UC01 : <<include>>
UC08 <-- UC02 : <<include>>
@enduml
----

== Use Cases

=== UC-01: Get Document Structure

[cols="1,3"]
|===
| **ID** | UC-01
| **Name** | Get document structure (get_structure)
| **Actor** | LLM Client
| **Priority** | Must-Have
| **Trigger** | Client needs overview of documentation structure
|===

==== Description
The LLM Client retrieves the hierarchical structure of a documentation project to get an overview of available chapters and sections.

==== Preconditions
* Server is started and index is built
* Documentation project is configured

==== Postconditions
* Client receives structured overview (Table of Contents)

==== Main Flow
1. Client sends `get_structure(max_depth)` request
2. Server consults the in-memory index
3. Server filters structure by `max_depth`
4. Server returns hierarchical structure

==== Alternative Flows
* **A1: Empty project** - Server returns empty structure
* **A2: Invalid max_depth** - Server uses default value

==== Activity Diagram

[plantuml, uc01-activity, svg]
----
@startuml
start
:Client sends get_structure(max_depth);

if (Index available?) then (yes)
  :Load structure from index;
  
  if (max_depth specified?) then (yes)
    :Filter structure by depth;
  else (no)
    :Use complete structure;
  endif
  
  :Format structure as JSON;
  :Send response to client;
else (no)
  :Error: Index not initialized;
  :Send error response;
endif

stop
@enduml
----

'''

=== UC-02: Read Section

[cols="1,3"]
|===
| **ID** | UC-02
| **Name** | Read section (get_section)
| **Actor** | LLM Client
| **Priority** | Must-Have
| **Trigger** | Client needs content of a specific section
|===

==== Description
The LLM Client reads the content of a specific section by its hierarchical path.

==== Preconditions
* Server is started and index is built
* Requested path exists in the project

==== Postconditions
* Client receives section content

==== Main Flow
1. Client sends `get_section(path)` request
2. Server searches path in index
3. Server determines file and line numbers
4. Server reads relevant lines from file
5. Server returns content

==== Alternative Flows
* **A1: Path not found** - Server returns 404 with error message
* **A2: File not readable** - Server returns 500 with error message

==== Activity Diagram

[plantuml, uc02-activity, svg]
----
@startuml
start
:Client sends get_section(path);

:Search path in index;

if (Path found?) then (yes)
  :Get SectionLocation from index;
  note right: file, start_line, end_line
  
  :Open file;
  
  if (File readable?) then (yes)
    :Read lines from start_line to end_line;
    :Send content as response;
  else (no)
    :HTTP 500 - File not readable;
  endif
  
else (no)
  :HTTP 404 - Path not found;
endif

stop
@enduml
----

'''

=== UC-03: Update Section

[cols="1,3"]
|===
| **ID** | UC-03
| **Name** | Update section (update_section)
| **Actor** | LLM Client
| **Priority** | Must-Have
| **Trigger** | Client wants to modify section content
|===

==== Description
The LLM Client updates the content of a specific section. The change is performed atomically.

==== Preconditions
* Server is started and index is built
* Requested path exists in the project
* File system is writable

==== Postconditions
* Section contains new content
* Index is updated
* Original file is unchanged on error

==== Main Flow
1. Client sends `update_section(path, content)` request
2. Server searches path in index
3. Server creates backup of original file
4. Server writes new content to temporary file
5. Server atomically replaces original file
6. Server updates index
7. Server deletes backup
8. Server confirms success

==== Alternative Flows
* **A1: Path not found** - Server returns 404
* **A2: Write error** - Server restores backup, returns 500
* **A3: Index update failed** - Log warning, report success

==== Activity Diagram

[plantuml, uc03-activity, svg]
----
@startuml
start
:Client sends update_section(path, content);

:Search path in index;

if (Path found?) then (yes)
  :Determine SectionLocation;
  
  :Create backup (.bak);
  
  :Write new content to .tmp;
  
  if (Write successful?) then (yes)
    :Replace original file with .tmp;
    :Delete backup;
    :Update index;
    :HTTP 200 - Success;
  else (no)
    :Delete temporary file;
    :Restore backup;
    :HTTP 500 - Write error;
  endif
  
else (no)
  :HTTP 404 - Path not found;
endif

stop
@enduml
----

'''

=== UC-04: Search Content

[cols="1,3"]
|===
| **ID** | UC-04
| **Name** | Search content (search_content)
| **Actor** | LLM Client
| **Priority** | Must-Have
| **Trigger** | Client searches for specific content
|===

==== Description
The LLM Client searches for text within the documentation project and receives a list of matches with context.

==== Preconditions
* Server is started and index is built

==== Postconditions
* Client receives list of matches with paths and context

==== Main Flow
1. Client sends `search_content(query)` request
2. Server searches indexed content
3. Server collects matches with context
4. Server returns result list

==== Alternative Flows
* **A1: No matches** - Server returns empty list
* **A2: Invalid query** - Server returns 400 with error message

==== Activity Diagram

[plantuml, uc04-activity, svg]
----
@startuml
start
:Client sends search_content(query);

if (Query valid?) then (yes)
  :Consult search index;
  
  :For each indexed section|
  if (Query in section?) then (yes)
    :Store match with context;
  endif
  
  if (Matches found?) then (yes)
    :Sort matches by relevance;
    :HTTP 200 with match list;
  else (no)
    :HTTP 200 with empty list;
  endif
  
else (no)
  :HTTP 400 - Invalid query;
endif

stop
@enduml
----

'''

=== UC-05: Filter Elements by Type

[cols="1,3"]
|===
| **ID** | UC-05
| **Name** | Filter elements by type (get_elements)
| **Actor** | LLM Client
| **Priority** | Must-Have
| **Trigger** | Client needs specific element types
|===

==== Description
The LLM Client retrieves all elements of a specific type (e.g., diagrams, tables, code blocks).

==== Preconditions
* Server is started and index is built

==== Postconditions
* Client receives list of all elements of the requested type

==== Main Flow
1. Client sends `get_elements(type)` request
2. Server filters index by element type
3. Server returns list of elements with paths

==== Supported Element Types
* `diagram` - PlantUML, Mermaid, etc.
* `table` - AsciiDoc/Markdown tables
* `code` - Code blocks
* `list` - Lists (ordered/unordered)
* `image` - Embedded images

==== Activity Diagram

[plantuml, uc05-activity, svg]
----
@startuml
start
:Client sends get_elements(type);

if (Type supported?) then (yes)
  :Filter index by type;
  
  :Collect elements;
  note right
    For each element:
    - Path
    - Preview/Title
    - Position
  end note
  
  :HTTP 200 with element list;
else (no)
  :HTTP 400 - Unknown type;
endif

stop
@enduml
----

'''

=== UC-06: Get Metadata

[cols="1,3"]
|===
| **ID** | UC-06
| **Name** | Get metadata (get_metadata)
| **Actor** | LLM Client
| **Priority** | Should-Have
| **Trigger** | Client needs information about document/section
|===

==== Description
The LLM Client retrieves metadata about the project or a specific section.

==== Preconditions
* Server is started and index is built

==== Postconditions
* Client receives metadata

==== Main Flow
1. Client sends `get_metadata(path?)` request
2. Server determines metadata from index and file system
3. Server returns metadata

==== Return Values
* Word count
* Last modified
* File path
* Number of subsections
* Include dependencies

==== Activity Diagram

[plantuml, uc06-activity, svg]
----
@startuml
start
:Client sends get_metadata(path?);

if (Path specified?) then (yes)
  :Search section in index;
  
  if (Found?) then (yes)
    :Collect section metadata;
  else (no)
    :HTTP 404;
    stop
  endif
else (no)
  :Collect project metadata;
endif

:Retrieve file stats;
note right: last_modified, size

:Calculate word count;

:Resolve include dependencies;

:HTTP 200 with metadata;

stop
@enduml
----

'''

=== UC-07: Validate Structure

[cols="1,3"]
|===
| **ID** | UC-07
| **Name** | Validate structure (validate_structure)
| **Actor** | LLM Client
| **Priority** | Should-Have
| **Trigger** | Client wants to check consistency
|===

==== Description
The LLM Client validates the structure of the documentation project for consistency and completeness.

==== Preconditions
* Server is started and index is built

==== Postconditions
* Client receives validation result

==== Checks
* Unresolved includes
* Circular includes
* Orphaned files
* Missing references
* Invalid paths

==== Activity Diagram

[plantuml, uc07-activity, svg]
----
@startuml
start
:Client sends validate_structure();

:Initialize validation results;

:Check includes;
note right: Unresolved, Circular

:Check cross-references;

:Identify orphaned files;

:Check structural integrity;

if (Errors found?) then (yes)
  :HTTP 200 with error list;
else (no)
  :HTTP 200 - Structure valid;
endif

stop
@enduml
----

'''

=== UC-08: Initialize Server

[cols="1,3"]
|===
| **ID** | UC-08
| **Name** | Initialize server
| **Actor** | System (at startup)
| **Priority** | Must-Have
| **Trigger** | Server is started
|===

==== Description
At startup, the server scans and indexes the configured documentation project.

==== Preconditions
* Documentation project path is configured
* Files are readable

==== Postconditions
* In-memory index is built
* Server is ready for requests

==== Main Flow
1. Server reads configuration
2. Server scans project directory for .adoc/.md files
3. Server parses each file
4. Server resolves include directives
5. Server builds hierarchical index
6. Server reports readiness

==== Alternative Flows
* **A1: No files found** - Server starts with empty index, logs warning
* **A2: Parse error** - Server logs error, skips file, continues
* **A3: Circular includes** - Server detects cycle, aborts include, logs warning

==== Activity Diagram

[plantuml, uc08-activity, svg]
----
@startuml
start
:Load configuration;
:Determine project path;

:Scan files (*.adoc, *.md);

if (Files found?) then (yes)
  
  while (More files?) is (yes)
    :Load next file;
    
    :Call parser;
    
    if (Parse successful?) then (yes)
      :Create AST;
      
      :Resolve includes;
      note right: Recursive, with cycle detection
      
      :Insert sections into index;
    else (no)
      :Log error;
      :Skip file;
    endif
  endwhile (no)
  
  :Finalize index;
  :Server ready;
  
else (no)
  :Warning: No files;
  :Empty index;
endif

stop
@enduml
----

'''

=== UC-09: Insert Content

[cols="1,3"]
|===
| **ID** | UC-09
| **Name** | Insert content (insert_at)
| **Actor** | LLM Client
| **Priority** | Must-Have
| **Trigger** | Client wants to add new content
|===

==== Description
The LLM Client inserts new content at a specific position (before, after, or within a section).

==== Preconditions
* Server is started and index is built
* Requested path exists
* File system is writable

==== Postconditions
* New content is inserted
* Index is updated

==== Main Flow
1. Client sends `insert_at(path, position, content)` request
2. Server validates position (before|after|append)
3. Server determines insertion position in file
4. Server performs atomic write operation
5. Server updates index
6. Server confirms success

==== Activity Diagram

[plantuml, uc09-activity, svg]
----
@startuml
start
:Client sends insert_at(path, position, content);

:Validate path and position;

if (Valid?) then (yes)
  :Determine target line;
  
  switch (position)
  case (before)
    :Line = start_line;
  case (after)
    :Line = end_line + 1;
  case (append)
    :Line = within section;
  endswitch
  
  :Create backup;
  :Insert content;
  :Save atomically;
  :Update index;
  
  :HTTP 200 - Success;
else (no)
  :HTTP 400 - Invalid parameters;
endif

stop
@enduml
----

'''

=== UC-10: Replace Element

[cols="1,3"]
|===
| **ID** | UC-10
| **Name** | Replace element (replace_element)
| **Actor** | LLM Client
| **Priority** | Should-Have
| **Trigger** | Client wants to replace a specific element
|===

==== Description
The LLM Client replaces a specific element (e.g., table, code block) within a section.

==== Preconditions
* Server is started and index is built
* Element exists at the specified position

==== Postconditions
* Element is replaced
* Index is updated

==== Main Flow
1. Client sends `replace_element(path, element_index, content)` request
2. Server locates element
3. Server validates new content
4. Server performs atomic replacement
5. Server updates index
6. Server confirms success

==== Activity Diagram

[plantuml, uc10-activity, svg]
----
@startuml
start
:Client sends replace_element(path, element_index, content);

:Load section;

:Locate element at index;

if (Element found?) then (yes)
  :Determine element boundaries;
  
  :Create backup;
  :Replace element with new content;
  :Save atomically;
  :Update index;
  
  :HTTP 200 - Success;
else (no)
  :HTTP 404 - Element not found;
endif

stop
@enduml
----

== Use Case Overview

[cols="1,2,1,1"]
|===
| ID | Name | Priority | API Group

| UC-01 | Get document structure | Must-Have | Navigation
| UC-02 | Read section | Must-Have | Navigation
| UC-03 | Update section | Must-Have | Manipulation
| UC-04 | Search content | Must-Have | Content-Access
| UC-05 | Filter elements by type | Must-Have | Content-Access
| UC-06 | Get metadata | Should-Have | Meta-Info
| UC-07 | Validate structure | Should-Have | Meta-Info
| UC-08 | Initialize server | Must-Have | System
| UC-09 | Insert content | Must-Have | Manipulation
| UC-10 | Replace element | Should-Have | Manipulation
|===

== Appendix: Glossary

[cols="1,3"]
|===
| Term | Definition

| **Hierarchical Path**
| Dot-separated path to a section, e.g., `chapter-1.section-2`

| **Include Directive**
| AsciiDoc instruction for including external files: `include::file.adoc[]`

| **Atomic Write Operation**
| Operation that is either completed entirely or not at all

| **In-Memory Index**
| Memory-resident data structure for fast path-to-position lookups

| **SectionLocation**
| Data structure with file, start, and end line of a section
|===
